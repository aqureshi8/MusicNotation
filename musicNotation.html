<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Music Notation</title>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://raw.github.com/mbostock/d3/v2.4.6/d3.layout.js" type='text/javascript'></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
		<style type="text/css">
		</style>
	</head>
	<body>
		<script type="text/javascript">

		var width = 700;
		var height = 830;
		var xpadding = 50;
		var ypadding = 50;

		var dataName = "Observation";

		var svg;
		var plotData = [];
		var lines;
		var dataCount;
		var minNum;
		var maxNum;

			d3.csv("Group 1, Day 1.csv", function(data) {

				//console.log(data);
				dataCount = data.length;

				plotData = data.map(function(d) {
					return d["Observation"];
				});

				//console.log(plotData);

				function createBars(startingPoint) {
					svg.append("line")
						.attr("x1", function(d, i) {
							return 10;
						})
						.attr("y1", function(d, i) {
							return startingPoint + 10;
						})
						.attr("x2", function(d, i) {
							return width - 10;
						})
						.attr("y2", function(d, i) {
							return startingPoint + 10;
						})
						.attr("stroke-width", 1)
						.attr("stroke", "blue");

					svg.append("line")
						.attr("x1", function(d, i) {
							return 10;
						})
						.attr("y1", function(d, i) {
							return startingPoint + 5*10 + 10;
						})
						.attr("x2", function(d, i) {
							return width - 10;
						})
						.attr("y2", function(d, i) {
							return startingPoint + 5*10 + 10;
						})
						.attr("stroke-width", 1)
						.attr("stroke", "goldenrod");

					svg.append("line")
						.attr("x1", function(d, i) {
							return 10;
						})
						.attr("y1", function(d, i) {
							return startingPoint + 10*10 + 10;
						})
						.attr("x2", function(d, i) {
							return width - 10;
						})
						.attr("y2", function(d, i) {
							return startingPoint + 10*10 + 10;
						})
						.attr("stroke-width", 1)
						.attr("stroke", "red");

					svg.append("line")
						.attr("x1", function(d, i) {
							return 10;
						})
						.attr("y1", function(d, i) {
							return startingPoint + 10*15 + 10;
						})
						.attr("x2", function(d, i) {
							return width - 10;
						})
						.attr("y2", function(d, i) {
							return startingPoint + 10*15 + 10;
						})
						.attr("stroke-width", 1)
						.attr("stroke", "green");
				}

				function draw(minArrowNum, maxArrowNum) {

					lines = svg.selectAll("lineY")
								.data(plotData)
								.enter()
								.append("g");

					lines.append("line")
							.attr("y1", function(d,i) {
								if(i >= minArrowNum && i < maxArrowNum) {
									if((parseInt(d.charAt(0)) - 1) == 0) {
										return (parseInt((i%264)/66) * 220) + 10;
									}
									else {
										return (parseInt((i%264)/66) * 220) + 10 * 5 * (parseInt(d.charAt(0)) - 1) + 10;
									}
								}
								else {
									return 0;
								}
							})
							.attr("x1", function(d,i) {
								if(i >= minArrowNum && i < maxArrowNum) {
									if((i%264)%66 == 0) {
										createBars(parseInt((i%264)/66) * 220);
									}
									return 10*((i%264)%66) + 25;
								}
								else {
									return 0;
								}
							})
							.attr("x2", function(d,i) {
								if(i >= minArrowNum && i < maxArrowNum) {
									return 10*((i%264)%66) + 25;
								}
								else {
									return 0;
								}
							})
							.attr("y2", function(d,i) {
								if(i >= minArrowNum && i < maxArrowNum) {
									if((parseInt(d.slice(-1)) - 1) == 0) {
										return (parseInt((i%264)/66) * 220) + 10;
									}
									else {
										return (parseInt((i%264)/66) * 220) + 10 * 5 * (parseInt(d.slice(-1)) - 1) + 10;
									}
								}
								else {
									return 0;
								}
							})
							.attr("stroke-width", 1)
							.attr("stroke", function(d,i) {
								if(parseInt(d.charAt(0)) == 1) {
									return "blue";
								}
								else if(parseInt(d.charAt(0)) == 2) {
									return "goldenrod";
								}
								else if(parseInt(d.charAt(0)) == 3) {
									return "red";
								}
								else if(parseInt(d.charAt(0)) == 4) {
									return "green";
								}
							});

					lines.append('path')
    		  			.attr('d', function(d,i) { 
    		  				if(i >= minArrowNum && i < maxArrowNum) {
	        					var x = 10*((i%264)%66) + 25;
    	    					if((parseInt(d.slice(-1)) - 1) == 0) {
										var y = (parseInt((i%264)/66) * 220) + 10;
									}
									else {
										var y = (parseInt((i%264)/66) * 220) + 10 * 5 * (parseInt(d.slice(-1)) - 1) + 10;
									};
								if(parseInt(d.charAt(0)) > parseInt(d.slice(-1))) {
									return 'M ' + x +' '+ y + ' l 5 5 l -10 0 z';
								}
        						else {
        							return 'M ' + x +' '+ y + ' l -5 -5 l 10 0 z';
        						}
        					}
        					else {
        						return null;
        					}
      					})
		      			.attr("fill", function(d,i) {
								if(parseInt(d.charAt(0)) == 1) {
									return "blue";
								}
								else if(parseInt(d.charAt(0)) == 2) {
									return "goldenrod";
								}
								else if(parseInt(d.charAt(0)) == 3) {
									return "red";
								}
								else if(parseInt(d.charAt(0)) == 4) {
									return "green";
								}
							});
				}

				minNum = 0;
				maxNum = 0;

				for(i=0; maxNum < dataCount; i++) {
					svg = d3.select("body")
							.append("svg")
							.attr("width", function() {
								return width;
							})
							.attr("height", function() {
								return height;
							})
					minNum = i*264;
					maxNum = (i+1)*264;
					draw(minNum,maxNum);
				}
			});

		</script>
	</body>
</html>